# MCS-51硬件资源及应用

## 并行 I/O 口

### 端口

### 应用

## 中断系统

### 中断概述

### 中断系统与控制

### 中断响应

### 中断请求的撤除

### 中断系统的初始化

### 单步工作方式

### 外部中断源的扩展

## 定时器 / 计数器

### 方法概述

### 定时器 / 计数器的定时和计数功能

### 控制寄存器

### 工作方式

### 初始化

### 应用实例

#### 中断方式

定时器/计数器的溢出中断是内部中断源，可以使用中断来进行异常处理。

```c

```

#### 查询方式

通过对标志位进行轮询来获取定时器状态

```c
#include <reg51.h>

sbit P1_0 = P1 ^ 0;

void main (void) {
    
    TMOD &= 0x0f; // 设置 T1 为 工作方式0，且不影响 T0 工作
    // 设置计数初值，为 cf3 = 3315
    TH1 = 0xfc;
    TL1 = 0x03;
    IE = x00; // 关闭中断
    TR1 = 1; // 启动定时器1
    for(;;) {
        
        if (TF1) { // 查询标志位
            
            TF1 = 0; // 清除标志位
            TH1 = 0xfc; // 重置初值
            TL1 = 0x03;
            P1_0 = ~P1_0;
        }
    }
}
```

## 串行接口及其串行通信

### 串行通信基础

- 数据按位顺序进行，最少只需一根数据线即可完成，成本低但速度慢

#### 异步串行通信的字符格式

1. 起始位 开始一个字符的标志位。起始位使数据线处于`0`状态
2. 数据位 
3. 奇偶校验位
4. 停止位
5. 位时间
6. 帧（frame）

#### 信号形式

1. 近程通信
2. 远程通信

#### 数据通路形式

1. 单工
2. 半双工
3. 全双工

#### 数据通信速率

每秒钟传输格式为的数目来表示，称为波特率（baud rate）

1 波特 = 1 bps

#### 串行接口电路 —— 通用的异步接收/发送器 （UART）

### 串行通信控制寄存器

#### SCON （98H）

各位说明：

- **SM0**, **SM1** 是串行口工作方式选择位，两位组合决定串行口的工作模式

    四种工作模式

    | SM0 SM1 | 工作方式 |      功能      |              波特率              |
    | :-----: | :------: | :------------: | :------------------------------: |
    |   0 0   |  方式0   | 扩展移位寄存器 |          $f_{osc}$ / 12          |
    |   0 1   |    1     |    8位 UART    |       定时器 T1 溢出率 / n       |
    |   1 0   |    2     |    9位 UART    | $f_{osc}$ / 32 或 $f_{osc}$ / 64 |
    |   1 1   |    3     |    9位 UART    |       定时器 T1 溢出率 / n       |

- **SM2** 是多机通信控制位

    主要作用与*方式2*与*方式3*

    - SM2 = 1

        只有当接收到的第九位数据（RB8）为1，才将接收到的前8位数据送入SBUF，并置位 RI 产生中断请求，否则丢弃。

    - SM2 = 0

        不论第九位是0还是1，都将接收到的前8位数据送入SBUF，并置位 RI 产生中断请求。

    在*方式1*时，若SM2=1，则只有接收到有效停止位时，RI才置1，以便接收下一帧数据。

    在*方式0*时，SM2必须为0。

- **REN** 是允许接收位

    - 为1时允许接收数据，为0时禁止接收数据，由软件控制。

- **TB8** 是发送数据的第9位

- **RB8** 是接收数据的第9位

- **TI** 是发送中断标志位

- **RI** 是接收中断标志位

#### 电源控制寄存器 PCON（87H）

### 串行通信工作方式

#### 串行口工作方式0

此方式下把串行口作为扩展移位寄存器使用，以 PXD(P3.0) 作为数据以为的入口和出口，由 TXD(P3.1) 提供移位时钟脉冲。移位数据的发送和接收以8位位一组，低位在前高位在后。

