# 理解 ES 分析器

## 引言

ES中，对文本进行分析是对文本进行搜索的很重要的前置条件，只有将文本分解成小的关键词，才能将文本与倒排索引相关联，才能在倒排索引中搜索到文本。

## 分析

要理解分析器，我们首先要了解ES中 **分析** 是一个怎样的概念。

*分析* 包含下面的过程：

1. 将一块文本分成适合与倒排索引的独立的**词条**；
2. 将这些词条统一化为标准格式以提高它们的“可搜索性”。

也就是说，分析操作就是搜索前，从文本中提取关键字的过程。

## 分析器

分析器是用于执行分析操作的工具。

分析器实际上是将三个功能封装到了一个包里：

**字符过滤器**

首先，字符串按顺序通过每个 *字符过滤器* 。他们的任务是在分词前整理字符串。一个字符过滤器可以用来去掉HTML，或者将 `&` 转化成 `and`。

**分词器**

其次，字符串被 *分词器* 分为单个的词条。一个简单的分词器遇到空格和标点的时候，可能会将文本拆分成词条。

**Token 过滤器**（词单元过滤器）

最后，词条按顺序通过每个 *token 过滤器* 。这个过程可能会改变词条（例如，小写化 `Quick` ），删除词条（例如， 像 `a`， `and`， `the` 等无用词），或者增加词条（例如，像 `jump` 和 `leap` 这种同义词）。

### 什么时候使用分析器

当我们**索引**一个文档时，它的**全文域**被分析成词条用来创建倒排索引。但是，当我们在全文域进行搜索的时候，我们需要将查询字符串通过*相同的分析过程*

，以保证我们搜索的词条格式与索引中的词条格式一致。

- 在进行**全文域**搜索时，会对查询字符串应用相同的分析器，以产生正确的搜索词条列表
- 在进行**精确值**域搜索时，不会分析查询字符串，而是搜索你指定的精确值。

### 测试分析器

使用 `analyze` API 来看文本是如何被分析的。

此处指定分析器为`standard`

文本为 `Text to analyze`

```json
GET /_analyze 
{
  "analyzer": "standard",
  "text": "Text to analyze"
}
```

### 创建一个自定义分析器

可以在`analysis`下的相应位置设置字符过滤器，分词器和词单元过滤器：

```json
PUT /my_index
{
    "settings": {
        "char_filter": {
            "char_filter": {},
            "tokenizer": {},
            "filter": {},
            "analyzer": {}
        }
    }
}
```

